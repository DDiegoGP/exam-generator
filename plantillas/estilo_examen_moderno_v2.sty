% estilo_examen_moderno.sty
\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{estilo_examen_moderno}[2025/01/11 Paquete de estilo moderno para examenes]

% --- Paquetes Básicos ---
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{geometry}
\usepackage{graphicx}
\usepackage{fancyhdr}
\usepackage{enumitem}
\usepackage{titlesec}
\usepackage{xcolor}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{tcolorbox}
\tcbuselibrary{skins}   % necesario para el parámetro height= en tcolorbox

% ============================================================================
% TIPOGRAFÍA - Comenta/Descomenta según necesites
% ============================================================================

% --- OPCIÓN 1: Computer Modern (Por defecto LaTeX) ---
% Ya está activa por defecto, no hacer nada

% --- OPCIÓN 2: Palatino (Elegante y muy legible) ---
%\usepackage{mathpazo}

% --- OPCIÓN 3: Times New Roman (Clásica académica) ---
%\usepackage{mathptmx}

% --- OPCIÓN 4: Libertine (Moderna y profesional) ---
%\usepackage{libertine}
%\usepackage[libertine]{newtxmath}

% ============================================================================

% --- Configuración de Márgenes ---
\geometry{
    a4paper,
    left=20mm,
    right=20mm,
    top=30mm,
    bottom=25mm,
    headheight=20mm,
    headsep=8mm
}

% ============================================================================
% ESQUEMAS DE COLOR - Comenta/Descomenta según necesites
% ============================================================================

% --- OPCIÓN 1: AZUL PROFESIONAL (Por defecto) ---
\definecolor{primario}{RGB}{41, 128, 185}      % Azul profesional
\definecolor{secundario}{RGB}{52, 73, 94}      % Gris azulado oscuro
\definecolor{acento}{RGB}{231, 76, 60}         % Rojo acento
\definecolor{fondo}{RGB}{236, 240, 241}        % Gris claro fondo
\definecolor{texto}{RGB}{44, 62, 80}           % Texto principal

% --- OPCIÓN 2: COLORES INSTITUCIONALES UCM ---
% Descomenta estas líneas y comenta las de arriba para usar colores UCM
%\definecolor{primario}{RGB}{165, 28, 48}       % Rojo granate UCM
%\definecolor{secundario}{RGB}{120, 20, 35}     % Granate oscuro
%\definecolor{acento}{RGB}{184, 134, 11}        % Dorado UCM
%\definecolor{fondo}{RGB}{245, 240, 235}        % Beige muy claro
%\definecolor{texto}{RGB}{40, 40, 40}           % Negro suave

% --- OPCIÓN 3: BLANCO Y NEGRO (Para impresión) ---
% Descomenta estas líneas y comenta las de arriba para B&N
%\definecolor{primario}{RGB}{60, 60, 60}        % Gris oscuro
%\definecolor{secundario}{RGB}{40, 40, 40}      % Gris muy oscuro
%\definecolor{acento}{RGB}{100, 100, 100}       % Gris medio
%\definecolor{fondo}{RGB}{245, 245, 245}        % Gris muy claro
%\definecolor{texto}{RGB}{0, 0, 0}              % Negro

% ============================================================================
% MODO COMPACTO - Para que quepan 6-10 preguntas fundamentales en página 1
% ============================================================================

% --- Descomentar la siguiente línea para activar modo compacto ---
%\def\modocompacto{1}

% ============================================================================

% --- Comandos para placeholders de Python (COMPATIBILIDAD TOTAL) ---
\newcommand{\tipoexamen}[1]{\def\thetipoexamen{#1}}
\newcommand{\institucion}[1]{\def\theinstitucion{#1}}
\newcommand{\asignatura}[1]{\def\theasignatura{#1}}
\newcommand{\fecha}[1]{\def\thefecha{#1}}
\newcommand{\duracion}[1]{\def\theduracion{#1}}
\newcommand{\version}[1]{\def\theversion{#1}}
\newcommand{\logo}[1]{\def\thelogo{#1}}

% Valores por defecto
\tipoexamen{EXAMEN} 
\institucion{} 
\asignatura{} 
\fecha{\today} 
\duracion{} 
\version{A} 
\logo{}

% --- Encabezado Profesional Moderno ---
\newcommand{\encabezadoprofesional}{
    \ifdefined\modocompacto
        % MODO COMPACTO: Encabezado pequeño sin logo
        \noindent
        {\Large\bfseries\color{primario}\thetipoexamen} \hfill {\large Versión \theversion}\\
        {\large\bfseries\theasignatura}\\
        {\small\theinstitucion{} | \thefecha{} | \theduracion}
        
        \vspace{3mm}
        \hrule
        \vspace{2mm}
    \else
        % MODO NORMAL: Encabezado completo con caja
        \begin{tcolorbox}[
            colback=white,
            colframe=primario,
            arc=2mm,
            boxrule=2pt,
            left=5mm,
            right=5mm,
            top=4mm,
            bottom=4mm
        ]
            \color{primario}
            \begin{minipage}[c]{0.7\textwidth}
                {\fontsize{24}{28}\selectfont\bfseries\thetipoexamen}\\[2mm]
                {\Large\bfseries\theasignatura}\\[1mm]
                {\large\theinstitucion}
            \end{minipage}%
            \begin{minipage}[c]{0.3\textwidth}
                \raggedleft
                \ifx\thelogo\empty
                \else
                    \includegraphics[height=25mm]{\thelogo}
                \fi
            \end{minipage}
        \end{tcolorbox}
        
        \vspace{3mm}

        % Información del examen (tcolorbox evita el bucle de TikZ con minimum width+align)
        \begin{tcolorbox}[
            colback=fondo,
            colframe=fondo,
            arc=2mm,
            boxrule=0pt,
            left=3mm, right=3mm, top=2mm, bottom=2mm
        ]
            \noindent
            \begin{minipage}[c]{0.48\linewidth}
                \textcolor{secundario}{\textbf{$\blacktriangleright$}} \textbf{Fecha:} \thefecha
            \end{minipage}%
            \begin{minipage}[c]{0.25\linewidth}
                \textcolor{secundario}{\textbf{$\circledcirc$}} \textbf{Duración:} \theduracion
            \end{minipage}%
            \begin{minipage}[c]{0.22\linewidth}
                \textcolor{secundario}{\textbf{$\blacksquare$}} \textbf{Versión:} \theversion
            \end{minipage}
        \end{tcolorbox}

        \vspace{3mm}
    \fi
}

% --- Configuración de Cabecera y Pie de página ---
\pagestyle{fancy}
\fancyhf{}
\fancyhead[L]{\small\textcolor{secundario}{\textbf{\theasignatura}}}
\fancyhead[R]{\small\textcolor{secundario}{Versión \theversion}}
\fancyfoot[C]{\small\textcolor{secundario}{Página \textbf{\thepage}}}
\renewcommand{\headrulewidth}{0.5pt}
\renewcommand{\headrule}{\hbox to\headwidth{\color{primario}\leaders\hrule height \headrulewidth\hfill}}
\renewcommand{\footrulewidth}{0pt}
% Personalizar pie (texto extra antes del número de página)
\newcommand{\piepagina}[1]{%
    \fancyfoot[C]{\small\textcolor{secundario}{#1 \quad --- \quad Página \textbf{\thepage}}}%
}

% --- Caja para datos del alumno moderna ---
\newcommand{\cajaalumno}{
    \ifdefined\modocompacto
        % MODO COMPACTO: Caja reducida en 2 líneas
        \vspace{2mm}
        \noindent\fbox{
            \begin{minipage}{\textwidth}
                \vspace{2mm}
                \small
                \textbf{Nombre y Apellidos:} \hrulefill \\[4mm]
                \textbf{DNI:} \rule{4cm}{0.4pt} \hfill \textbf{Firma:} \rule{5cm}{0.4pt}
                \vspace{2mm}
            \end{minipage}
        }
        \vspace{3mm}
        \thispagestyle{empty} % Sin encabezado en página 1
    \else
        % MODO NORMAL: Caja completa
        \vspace{3mm}
        \begin{tcolorbox}[
            colback=white,
            colframe=secundario,
            arc=2mm,
            boxrule=1pt,
            left=5mm,
            right=5mm,
            top=3mm,
            bottom=3mm
        ]
            \textcolor{secundario}{\textbf{$\bullet$}} \textbf{Nombre y Apellidos:} \hrulefill \\[8mm]
            \begin{minipage}[t]{0.45\textwidth}
                \textcolor{secundario}{\textbf{$\blacktriangleright$}} \textbf{DNI:} \hrulefill
            \end{minipage}%
            \hspace{0.05\textwidth}%
            \begin{minipage}[t]{0.45\textwidth}
                \textcolor{secundario}{\textbf{$\checkmark$}} \textbf{Firma:}
                \vspace{8mm}
            \end{minipage}
        \end{tcolorbox}
        \vspace{5mm}
    \fi
}

% --- Caja para Instrucciones Generales ---
\newcommand{\instrucciones}[1]{%
    \vspace{2mm}
    \noindent
    \begin{tcolorbox}[
        colback=white,
        colframe=secundario,
        arc=1mm,
        boxrule=0.5pt,
        left=4mm,
        right=4mm,
        top=2mm,
        bottom=2mm
    ]
        \textcolor{secundario}{\textbf{$\triangleright$ Instrucciones:}} #1
    \end{tcolorbox}
    \vspace{2mm}
}

% --- Formato de Secciones (SIMPLE, sin fondos raros) ---
\titleformat{\section}
    {\Large\bfseries\color{primario}}
    {}
    {0em}
    {}
    [\vspace{0.3em}{\color{primario}\titlerule[1pt]}\vspace{0.5em}]

\titleformat{\subsection}
    {\large\bfseries\color{secundario}}
    {}
    {0em}
    {}

% --- Formato de Listas y Preguntas ---
\ifdefined\modocompacto
    % MODO COMPACTO: Espaciado reducido
    \setlist[enumerate,1]{
        label=\protect\circled{\arabic*},
        leftmargin=*,
        itemsep=0.8em,
        topsep=0.5em,
        before={\color{texto}},
        after={}
    }
\else
    % MODO NORMAL: Espaciado estándar
    \setlist[enumerate,1]{
        label=\protect\circled{\arabic*},
        leftmargin=*,
        itemsep=1.5em,
        topsep=1em,
        before={\color{texto}},
        after={}
    }
\fi

% Segunda lista (opciones) - letras con estilo moderno
\setlist[enumerate,2]{
    label=\textcolor{secundario}{\textbf{\alph*)}},
    leftmargin=2em,
    itemsep=0.5em,
    topsep=0.3em
}

% Estilos de numeración de preguntas
% \circled   → cuadrado (por defecto, redefinible desde el .tex)
% \circledCirculo → círculo con tcolorbox
% \circledNumero  → número en color, sin caja
\newcommand*\circled[1]{%
    {\setlength{\fboxsep}{3pt}%
     \fcolorbox{primario}{primario!10}{%
         \textbf{\textcolor{primario}{\small#1}}%
     }}%
}
\newcommand*\circledCirculo[1]{%
    \tcbox[on line,arc=5mm,colback=primario!10,colframe=primario,%
           boxsep=2pt,left=0pt,right=0pt,top=0pt,bottom=0pt,boxrule=0.8pt]{%
        \textbf{\textcolor{primario}{\small#1}}}%
}
\newcommand*\circledNumero[1]{%
    \textbf{\textcolor{primario}{#1.}}%
}

% --- Soporte para caracteres especiales de Física ---
\usepackage{newunicodechar}
\newunicodechar{Δ}{\ensuremath{\Delta}}
\newunicodechar{π}{\ensuremath{\pi}}
\newunicodechar{λ}{\ensuremath{\lambda}}
\newunicodechar{±}{\ensuremath{\pm}}
\newunicodechar{α}{\ensuremath{\alpha}}
\newunicodechar{β}{\ensuremath{\beta}}
\newunicodechar{γ}{\ensuremath{\gamma}}
\newunicodechar{Ω}{\ensuremath{\Omega}}
\newunicodechar{μ}{\ensuremath{\mu}}
\newunicodechar{°}{\ensuremath{^\circ}}
\newunicodechar{−}{\ensuremath{-}}   % U+2212 MINUS SIGN (distinto del guión ASCII)

% --- Configuración de colores de texto ---
\color{texto}

% --- Caja de espacio para respuestas de desarrollo ---
% Uso: \espaciorespuesta[6cm]  (altura opcional, defecto 6cm)
% Implementación sin height= de tcolorbox para máxima compatibilidad
\newcommand{\espaciorespuesta}[1][6cm]{%
    \par\vspace{2mm}\noindent%
    \fbox{%
        \begin{minipage}[t][#1][t]{\dimexpr\linewidth-2\fboxsep-2\fboxrule\relax}%
            \hspace{0pt}%
        \end{minipage}%
    }%
    \par\vspace{2mm}%
}

% --- Separador de sección del examen ---
% Uso: \seccionexamen{PARTE II --- TEST}{6 pts · pen: -1/3}
%      (el segundo argumento es opcional; si está vacío no se muestra)
\newcommand{\seccionexamen}[2]{%
    \vspace{4mm}%
    \noindent%
    {\Large\bfseries\color{primario}#1%
    \ifx&#2&%
    \else%
        \hfill{\normalsize\color{secundario}[#2]}%
    \fi}%
    \par\nobreak%
    {\color{primario}\rule{\linewidth}{1.5pt}}%
    \vspace{2mm}%
}

% --- Info de pregunta para versión soluciones ---
% Uso: \infopregunta{bloque}{tema}{dificultad}
\newcommand{\infopregunta}[3]{%
    \par\vspace{0.5mm}%
    {\scriptsize\textcolor{gray!70}{%
        \textit{Bloque: #1 \textperiodcentered{} Tema: #2 \textperiodcentered{} Dif.: #3}%
    }}%
    \par\vspace{0.5mm}%
}

\endinput
